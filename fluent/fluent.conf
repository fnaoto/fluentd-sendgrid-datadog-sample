# https://github.com/DataDog/fluent-plugin-datadog
# https://github.com/hiroakis/fluent-plugin-sendgrid-event
# https://github.com/sonots/fluent-plugin-grepcounter

<source>
  @type sendgrid_event
  host 0.0.0.0
  port 9191
  tag sendgrid.event
</source>

<match sendgrid.**>
  @type grepcounter
  count_interval 60
  input_key event
  regexp delivered
  threshold 1
  add_tag_suffix delivered.datadog
</match>

<match sendgrid.**>
  @type grepcounter
  count_interval 60
  input_key event
  regexp bounce
  threshold 1
  add_tag_suffix bounce.datadog
</match>

<match sendgrid.**>
  @type grepcounter
  count_interval 60
  input_key event
  regexp dropped
  add_tag_suffix dropped.datadog
</match>

<match **.datadog>
  @type datadog
  @id awesome_agent
  api_key "#{ENV['DD_API_KEY']}"
</match>

<match **>
  @type stdout
</match>
